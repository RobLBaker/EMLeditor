---
title: "EMLeditor"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{EMLeditor}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
# Dependencies
In addition to EMLeditor, you will also need the EML package to complete these steps. You can download and install everything you need from the [NPSdataverse](https://github.com/nationalparkservice/NPSdataverse) using:

```{r depends, eval=FALSE}
install.packages("devtools")
devtools::install_github("nationalparkservice/NPSdataverse")
```

# Workflow outline

EMLeditorâ€™s primary objective is to edit and view EML formatted files, not to generate them from scratch. A suggested workflow is:

1) Use the EMLassemblyline::make_eml() to generate an initial EML document and save it as a .xml file (NPS naming convention is: *_metadata.xml)
2) Use the EML::read_eml() function to load your EML file into R as an R object.
3) Use EMLeditor functions to edit the metadata in R and evaluate whether your metadata is acceptable (don't forget to use EML::eml_validate() to make sure you are generating valid EML).
4) Use the EML::write_eml() function to write the R object back to XML (remember the NPS naming convention for metadata files is *_metadata.xml).

If you use EMLeditor functions to alter your metadata (e.g. "set" class functions) they will also silently add the National Park Service as a publisher (including location, ROR, etc) to your metadata unless you set NPS=FALSE. If you leave the default setting as NPS=TRUE, EMLeditor will also assume the data package is being created "by or for the NPS" and add that information to the metadata. 

Set class functions will also inject information about which version of EMLeditor you used into the metadata.

# A Minimal Workflow

This workflow assumes your EML was generated using [EMLassemblyline](https://github.com/EDIorg/emlAssemblyLine), but will also work with any number of other EML generators (e.g. [ezEML]("https://ezeml.edirepository.org/eml/")).

Currently, many of the steps in EMLeditor are interactive and will give you feedback on the current fields in your metadata, ask if you want to update them, and report on the results of your edits. 

### Import your metadata into R

```{r import, eval=FALSE}
my_metadata <- EML::read_eml("mymetadata_metdata.xml", from="xml")
```

### Add information about CUI

Add information about your Controlled Unclassified Information (CUI). Because it is important to indicate not only what type of CUI there is, but when (and why) there is not CUI, **you must do this even if your data package does not contain CUI**. Choose from one of seven CUI codes these are:

  * PUBFUL - Does NOT contain CUI. The original data contained no CUI. No data were obscured or altered to generate the data package.
  * PUBVER - Does NOT contain CUI. The original data contained CUI, but in this data package CUI have been obscured so that it no longer contains CUI.
  * NPSONLY - Contains CUI. For NPS access only.
  * FED ONLY - Contains CUI. Only federal employees should have access (similar to "internal only" in DataStore).
  * FEDCON - Contains CUI. Only federal employees and federal contractors should have access (also very much like current "internal only" setting in DataStore)
  * DL ONLY - Contains CUI. Should only be available to a names list of individuals (where and how to list those individuals TBD)
  * NOCON - Contains  CUI. Federal, state, local, or tribal employees may have access, but contractors cannot.
  
The first three codes are NPS specific. More information about the remaining four codes can be found on the [National Archives website](https://www.archives.gov/cui/registry/limited-dissemination).

```{r cui, eval=FALSE}
my_meta2 <- set_cui(my_metadata, "PUBFUL")
```

### Add a data package DOI

Add your data package's Digital Object Identifier (DOI). To do this, you will need the seven-digit Reference ID from DataStore for the data package. To get the code, go to [DataStore](https://irma.nps.gov/DataStore/) and initiate a draft reference (but do not activate it). This act reserves your DOI, but it is not activated until after your data package is published.

There is no need to fill in any additional fields in DataStore at this point - many of them will automatically be populated based on your metadata at upload.

``` {r doi, eval=FALSE}
my_meta2 <- set_doi(my_meta2, 1234567)
```

### Add information about the DRR (optional)

If you are producing (or plan to produce) a DRR, add links to the DRR describing the data package. 

Similarly to set DOI, you will need the DOI for the DRR you are drafting as well as the DRR's Title. Again, go to [DataStore](https://irma.nps.gov/DataStore) and initiate a draft DRR, including a title. For the purposes of the data package, there is no need to populate any other fields. At this point, you do not need to activate the DRR reference and, while a DOI has been reserved for your DRR, it will not be activated until after publication so that you have plenty of time to construct the DRR.

```{r drr_doi, eval=FALSE}
my_meta2 <- set_drr_doi(my_meta2, 7654321, "DRR Title")
```

### Set the language

This is the human language (as opposed to computer language) that the data package and metadata are constructed in. Examples include English, Spanish, Navajo, etc.

``` {r language, eval=FALSE}
my_meta2 <- set_language(my_meta2, "English")
```

### Add the Park Units

These are the units where data were collected from, for instance ROMO, not ROMN. If the data package includes data from more than one park, they can all be listed. For instance, if data were collected from all park units within a network, each unit should be listed individually rather than the network. This is because the geographic coordinates corresponding to bounding boxes for each park unit listed will automatically be generated and inserted into the metadata. Individual park units will be more informative than the bounding box for the entire network.

``` {r park_units, eval=FALSE}
park_units<-("ROMO", "GRSD", "YELL")
my_meta2 <- set_park_units(my_meta2, park_units)
```

### Add the Producing Unit

This is the unit responsible for generating the data package. It may be a single park (ROMO) or a network (ROMN). It may be identical to the units listed in the previous step, overlapping, or entirely different.

```{r prod_units, eval=FALSE}
my_meta2 <- set_producing_units(my_meta2, "ROMN")
```

Great! You're done adding the essentail NPS-specific metadata to your EML. There's only two quick steps left:

### Validate your EML 

OK, this first one might take a tick to run:

```{r validate, eval=FALSE}
EML::eml_validate(my_meta2)
```

If eml_validate returns errors, inspect them and fix them. Feel free to contribute an [issue](https://github.com/nationalparkservice/EMLeditor/issues), or email [Rob Baker](mailto:robert_baker@nps.gov?subject=EMLeditor%20issues) with questions, concerns, or suggestions. 


### Write your edited EML back to disk

Assuming everything went smoothly and eml_validate returns 'TRUE', write your EML back to your disk so you can upload it with your data files to DataStore. Keep in mind that the file name should end in _metadata.xml. Also, when uploading your data package (data files and metadata) to DataStore, make sure to upload it to the correct draft reference!

```{r write, eval=FALSE}
EML::write_eml(my_meta2, "mymetadatafilename_metadata.xml")
```

